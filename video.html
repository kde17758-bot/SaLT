<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Video Client</title>
</head>
<body style="margin: 0; background: black;">
  <video id="video"
         style="display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; object-fit: cover; z-index: 9999;"
         autoplay playsinline></video>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const myIndex = urlParams.get('index');
    const videoEl = document.getElementById('video');

    const ws = new WebSocket('ws://192.168.0.2:7437');

    ws.onopen = () => {
      console.log("âœ… WebSocket ì—°ê²°ë¨ (index = " + myIndex + ")");
    };

    ws.onmessage = async (msg) => {
      let text;

      // msg.dataê°€ Blobì¸ì§€ ë¬¸ìì—´ì¸ì§€ í™•ì¸
      if (msg.data instanceof Blob) {
        text = await msg.data.text();  // Blob â†’ ë¬¸ìì—´ ë³€í™˜
      } else {
        text = msg.data;               // ì´ë¯¸ ë¬¸ìì—´ì´ë©´ ê·¸ëŒ€ë¡œ ì‚¬ìš©
      }

      let data;
      try {
        data = JSON.parse(text);
      } catch (e) {
        console.error("âŒ JSON íŒŒì‹± ì‹¤íŒ¨:", e);
        return;
      }

      // ì˜ìƒ ì¬ìƒ ì¡°ê±´
      if (data.action === 'playVideo' && data.videoIndex == myIndex) {
        videoEl.src = data.videoPath;
        videoEl.style.display = 'block';
        videoEl.currentTime = 0;

        videoEl.play()
          .then(() => console.log("â–¶ ì˜ìƒ ì¬ìƒ ì‹œì‘"))
          .catch(err => console.error("âŒ ì˜ìƒ ì¬ìƒ ì‹¤íŒ¨:", err));

        videoEl.onended = () => {
          console.log("ğŸ ì˜ìƒ ë!");
          videoEl.style.display = 'none';
        };
      }
    };
  </script>
</body>
</html>
